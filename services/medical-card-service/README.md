# API сервиса медицинских карт

| Ресурс                                       | Метод  | Что делает                                         | Доступ              |
|----------------------------------------------|--------|----------------------------------------------------|---------------------|
| /cards                                       | POST   | Добавляет медкарту в базу                          | Администратор       |
| /cards                                       | GET    | Возвращает список идентификаторов карты и пациента | Администратор, Врач |
| /cards/{card_id}                             | GET    | Возвращает медкарту                                | Администратор, Врач |
| /cards/me/{user_id}                          | GET    | Возвращает медкарту для пациента                   | Пациент             |
| /cards/{card_id}                             | PATCH  | Обновляет медкарту                                 | Администратор       |
| /cards/{card_id}                             | DELETE | Удаляет медкарту из базы                           | Администратор       |
| /pages/card/{card_id}/template/{template_id} | POST   | Добавляет страницу в базу                          | Врач                |
| /pages/card/{card_id}                        | GET    | Возвращает список страниц                          | Пациент, Врач       |
| /pages/{page_id}                             | PUT    | Обновляет страницу                                 | Врач                |
| /pages/{page_id}                             | DELETE | Удаляет страницу из базы                           | Врач                |
| /family_status                               | GET    | Возвращает список доступных семейных статусов      | Администратор       |
| /education                                   | GET    | Возвращает список доступных типов образования      | Администратор       |
| /busyness                                    | GET    | Возвращает список доступных типов занятости        | Администратор       |


# Зависимости

Перед запуском сервиса необходимо установить зависимости из файла requirements.txt

# Запуск

```bash
uvicorn app:app --port 5000 --reload
```

# Запуск с использование файла конфигурации .env

Для запуска из файла конфигурации нужно поместить файл .env в корень сервиса

# Запуск с переопределением переменных окружения

```bash
uvicorn app:app --port 5000 --reload
```

или

```bash
export POSTGRES_DSN=postgresql://postgres:postgres@localhost:5432/postgres 
export DEFAULT_DATA_PATH=default-data.json 
export ENCRYPT_KEY=encrypt_key
uvicorn app:app --reload
```

# Конфигурация
| Переменная        | Назначение                                                         | Значение по-умолчанию                        |
|-------------------|--------------------------------------------------------------------|----------------------------------------------|
| POSTGRES_DSN      | Строка подключения к PostgreSQL                                    | postgresql://user:pass@localhost:5432/foobar |
| DEFAULT_DATA_PATH | Путь к файлу с данными о семейном статусе, образовании и занятости | default-data.json                            |
| ENCRYPT_KEY       | Ключ для шифрования и дешифрования данных в формате base64         | encrypt_key                                  |

# Документация

После запуска доступна документация: http://127.0.0.1:5000/docs

# Сборка образа
```bash
docker build -t medical-system/medical-card-service:0.0.1 .
```

или

```bash
./build_image.sh
```