# API сервиса чатов и видеоконференций

| Ресурс                   | Метод  | Что делает                           | Доступ         |
|--------------------------|--------|--------------------------------------|----------------|
| /chats                   | POST   | Создает чат                          | Врач           |
| /chats/{user_id}         | GET    | Возвращает список чатов пользователя | Пациент, Врач  |
| /messages/last/{chat_id} | GET    | Возвращает последние 20 сообщений    | Пациент, Врач  |
| /messages/{message_id}   | DELETE | Удаляет сообщение                    | Пациент, Врач  |
| /meetings                | POST   | Создает встречу                      | Пациент        |
| /meetings                | GET    | Возвращает список встреч             | Пациент, Врач  |
| /meetings/{meeting_id}   | GET    | Возвращает информацию о встрече      | Пациент, Врач  |

# Зависимости

Перед запуском сервиса необходимо установить зависимости из файла requirements.txt

# Запуск

```bash
uvicorn app:app --port 5000 --reload
```

# Запуск с использование файла конфигурации .env

Для запуска из файла конфигурации нужно поместить файл .env в корень сервиса

# Конфигурация
| Переменная         | Назначение                                                  | Значение по умолчанию                                 |
|--------------------|-------------------------------------------------------------|-------------------------------------------------------|
| POSTGRES_DSN_ASYNC | Строка для подключения к PostgreSQL                         | postgresql+asyncpg://user:pass@localhost:5432/foobar  |
| CLIENT_ID          | Идентификатор клиента в приложении zoom                     | client_id                                             |
| ACCOUNT_ID         | Идентификатор аккаунта в приложении zoom                    | account_id                                            |
| CLIENT_SECRET      | Секретная фраза клиента в приложении zoom                   | client_secret                                         |
| PATH_TO_STORAGE    | Путь к файлам сообщений                                     | storage/                                              |
| ENCRYPT_KEY        | Ключ для шифрования и дешифрования данных в формате base64  | encrypt_key                                           |

# Документация

После запуска доступна документация: http://127.0.0.1:5000/docs

# Сборка образа
```bash
docker build -t medical-system/chat-service:0.0.1 .
```

или

```bash
./build_image.sh
```