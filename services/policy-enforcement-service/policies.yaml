services:
    - name: template-service
      entrypoint: http://template-service:5001/
      inject_token_in_swagger: True
    - name: medical-card-service
      entrypoint: http://medical-card-service:5002/
      inject_token_in_swagger: True
    - name: user-service
      entrypoint: http://user-service:5003/
      inject_token_in_swagger: True
    - name: health-diary-service
      entrypoint: http://health-diary-service:5004/
      inject_token_in_swagger: True
    - name: record-service
      entrypoint: http://record-service:5005/
      inject_token_in_swagger: True
model: |
    [request_definition]
    r = sub, obj, act
    
    [policy_definition]
    p = sub_rule, obj, act
    
    [policy_effect]
    e = some(where (p.eft == allow))
    
    [matchers]
    m = eval(p.sub_rule) && keyMatch(r.obj, p.obj) && regexMatch(r.act, p.act)
policies:
    - service: template-service
      rule: r.sub.group_id == 1
      resource: /templates*
      methods: (GET)|(POST)|(PATCH)|(DELETE)
    - service: template-service
      rule: r.sub.group_id == 2
      resource: /templates*
      methods: GET

    - service: medical-card-service
      rule: r.sub.group_id == 1
      resource: /cards/*
      methods: (GET)|(POST)|(PATCH)|(DELETE)
    - service: medical-card-service
      rule: r.sub.group_id == 1
      resource: /family_status
      methods: GET
    - service: medical-card-service
      rule: r.sub.group_id == 1
      resource: /education
      methods: GET
    - service: medical-card-service
      rule: r.sub.group_id == 1
      resource: /busyness
      methods: GET
    - service: medical-card-service
      rule: r.sub.group_id == 2
      resource: /cards/*
      methods: GET
    - service: medical-card-service
      rule: r.sub.group_id == 3
      resource: /cards/user/*
      methods: GET
    - service: medical-card-service
      rule: r.sub.group_id == 2
      resource: /pages/*
      methods: (GET)|(POST)|(PUT)|(DELETE)
    - service: medical-card-service
      rule: r.sub.group_id == 2
      resource: /documents*
      methods: (GET)|(POST)|(PATCH)|(DELETE)

    - service: user-service
      rule: r.sub.group_id == 1
      resource: /groups*
      methods: (GET)|(POST)|(PUT)|(DELETE)
    - service: user-service
      resource: /auth/*
      methods: POST
      white_list: true
    - service: user-service
      rule: r.sub.group_id == 1
      resource: /users*
      methods: (GET)|(POST)|(PUT)|(DELETE)
    - service: user-service
      rule: r.sub.group_id == 2
      resource: /users
      methods: GET
    - service: user-service
      rule: r.sub.group_id == 3
      resource: /users/me
      methods: (GET)|(PATCH)
    - service: user-service
      rule: r.sub.group_id == 3
      resource: /users/me/img
      methods: (PATCH)|(DELETE)
    - service: user-service
      rule: r.sub.group_id == 1
      resource: /specializations*
      methods: (GET)|(POST)|(PATCH)|(DELETE)
    - service: user-service
      rule: r.sub.group_id == 3
      resource: /specializations*
      methods: GET

    - service: health-diary-service
      rule: r.sub.group_id == 2
      resource: /diaries/user/*
      methods: GET
    - service: health-diary-service
      rule: r.sub.group_id == 3
      resource: /diaries/*
      methods: (GET)|(POST)|(PATCH)|(DELETE)

    - service: record-service
      rule: r.sub.group_id == 1
      resource: /schedules*
      methods: (GET)|(POST)|(PATCH)|(DELETE)
    - service: record-service
      rule: r.sub.group_id == 1
      resource: /records*
      methods: (GET)|(POST)|(PATCH)|(DELETE)
    - service: record-service
      rule: r.sub.group_id == 2
      resource: /records/doctor/*
      methods: GET
    - service: record-service
      rule: r.sub.group_id == 3
      resource: /records
      methods: POST
    - service: record-service
      rule: r.sub.group_id == 3
      resource: /records/user/*
      methods: GET
    - service: record-service
      rule: r.sub.group_id == 3
      resource: /schedules/dates
      methods: GET